from flask import Flask, request, jsonify
from flask_cors import CORS  # CORS ëª¨ë“ˆ ì¶”ê°€
import os
import glob

app = Flask(__name__)
CORS(app)  # CORS í—ˆìš©

# âœ… JSON ì‘ë‹µì—ì„œ ASCII ë³€í™˜ì„ ë°©ì§€í•˜ì—¬ í•œê¸€ì´ ê¹¨ì§€ì§€ ì•Šë„ë¡ ì„¤ì •
app.config['JSON_AS_ASCII'] = False  

# ğŸ”¹ HTML íŒŒì¼ì´ ì €ì¥ëœ ìµœìƒìœ„ í´ë” ê²½ë¡œ
HTML_FOLDER = r'E:\OneDrive\HTML'

# âœ… ê¸°ë³¸ ë£¨íŠ¸ í˜ì´ì§€ ì¶”ê°€
@app.route('/')
def home():
    return jsonify({"message": "Flask ì„œë²„ê°€ ì •ìƒì ìœ¼ë¡œ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤."})

@app.route('/search', methods=['GET'])
def search_html_files():
    search_term = request.args.get('query', '')

    if not search_term:
        return jsonify({"error": "ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”."}), 400

    # ğŸ”¹ í´ë” ë‚´ ëª¨ë“  HTML íŒŒì¼ ê²€ìƒ‰
    html_files = glob.glob(os.path.join(HTML_FOLDER, '**', '*.html'), recursive=True)
    
    results = []
    for file in html_files:
        with open(file, 'r', encoding='utf-8') as f:
            content = f.read()
            if search_term in content:
                results.append({"filename": os.path.basename(file), "filepath": file})

    return jsonify({"results": results})  # âœ… ensure_ascii=False ì œê±°

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=5000, debug=True)
